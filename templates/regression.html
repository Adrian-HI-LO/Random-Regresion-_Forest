{% extends 'base.html' %}

{% block title %}Regresi√≥n - Malware Detector{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem; font-size: 2.5rem;">üìä Random Forest Regressor</h1>
<p style="color: var(--text-secondary); margin-bottom: 2rem;">
    Predicci√≥n de la duraci√≥n del tr√°fico de red usando Random Forest Regressor
</p>

<!-- M√©tricas Principales -->
<div class="card">
    <h2 class="card-title">R¬≤ Score - Coeficiente de Determinaci√≥n</h2>
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-label">Entrenamiento</div>
            <div class="metric-value" style="color: var(--success);">{{ metrics.train.r2|floatformat:4 }}</div>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                R¬≤ en conjunto de entrenamiento
            </p>
        </div>
        <div class="metric-card">
            <div class="metric-label">Validaci√≥n</div>
            <div class="metric-value" style="color: var(--warning);">{{ metrics.validation.r2|floatformat:4 }}</div>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                R¬≤ en conjunto de validaci√≥n
            </p>
        </div>
        <div class="metric-card">
            <div class="metric-label">Test</div>
            <div class="metric-value" style="color: var(--accent);">{{ metrics.test.r2|floatformat:4 }}</div>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                R¬≤ en conjunto de test
            </p>
        </div>
    </div>
    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 6px; margin-top: 1rem;">
        <p style="color: var(--text-secondary); font-size: 0.875rem; margin: 0;">
            <strong>Nota:</strong> Un R¬≤ de 1.0 indica predicciones perfectas. Valores cercanos a 1.0 indican un excelente ajuste del modelo.
        </p>
    </div>
</div>

<!-- Todas las M√©tricas -->
<div class="card">
    <h2 class="card-title">M√©tricas Completas por Conjunto</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Conjunto de Datos</th>
                    <th>R¬≤ Score</th>
                    <th>RMSE</th>
                    <th>MAE</th>
                    <th>MSE</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Entrenamiento</strong></td>
                    <td><strong style="color: var(--success);">{{ metrics.train.r2|floatformat:4 }}</strong></td>
                    <td>{{ metrics.train.rmse|floatformat:2 }}</td>
                    <td>{{ metrics.train.mae|floatformat:2 }}</td>
                    <td>{{ metrics.train.mse|floatformat:2 }}</td>
                </tr>
                <tr>
                    <td><strong>Validaci√≥n</strong></td>
                    <td><strong style="color: var(--warning);">{{ metrics.validation.r2|floatformat:4 }}</strong></td>
                    <td>{{ metrics.validation.rmse|floatformat:2 }}</td>
                    <td>{{ metrics.validation.mae|floatformat:2 }}</td>
                    <td>{{ metrics.validation.mse|floatformat:2 }}</td>
                </tr>
                <tr style="background-color: rgba(88, 166, 255, 0.1);">
                    <td><strong>Test</strong></td>
                    <td><strong style="color: var(--accent);">{{ metrics.test.r2|floatformat:4 }}</strong></td>
                    <td>{{ metrics.test.rmse|floatformat:2 }}</td>
                    <td>{{ metrics.test.mae|floatformat:2 }}</td>
                    <td>{{ metrics.test.mse|floatformat:2 }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- M√©tricas Detalladas -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
    <div class="card">
        <h3 class="card-title">R¬≤ Score</h3>
        <div style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: 6px; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <span style="color: var(--text-secondary);">Train</span>
                <strong style="color: var(--accent);">{{ metrics.train.r2|floatformat:4 }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <span style="color: var(--text-secondary);">Validation</span>
                <strong style="color: var(--accent);">{{ metrics.validation.r2|floatformat:4 }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--text-secondary);">Test</span>
                <strong style="color: var(--success); font-size: 1.2rem;">{{ metrics.test.r2|floatformat:4 }}</strong>
            </div>
        </div>
        <p style="color: var(--text-secondary); font-size: 0.875rem;">
            Proporci√≥n de varianza en los datos explicada por el modelo
        </p>
    </div>

    <div class="card">
        <h3 class="card-title">RMSE</h3>
        <div style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: 6px; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <span style="color: var(--text-secondary);">Train</span>
                <strong style="color: var(--accent);">{{ metrics.train.rmse|floatformat:2 }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <span style="color: var(--text-secondary);">Validation</span>
                <strong style="color: var(--accent);">{{ metrics.validation.rmse|floatformat:2 }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--text-secondary);">Test</span>
                <strong style="color: var(--warning); font-size: 1.2rem;">{{ metrics.test.rmse|floatformat:2 }}</strong>
            </div>
        </div>
        <p style="color: var(--text-secondary); font-size: 0.875rem;">
            Ra√≠z del error cuadr√°tico medio (Root Mean Squared Error)
        </p>
    </div>

    <div class="card">
        <h3 class="card-title">MAE</h3>
        <div style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: 6px; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <span style="color: var(--text-secondary);">Train</span>
                <strong style="color: var(--accent);">{{ metrics.train.mae|floatformat:2 }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <span style="color: var(--text-secondary);">Validation</span>
                <strong style="color: var(--accent);">{{ metrics.validation.mae|floatformat:2 }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--text-secondary);">Test</span>
                <strong style="color: var(--warning); font-size: 1.2rem;">{{ metrics.test.mae|floatformat:2 }}</strong>
            </div>
        </div>
        <p style="color: var(--text-secondary); font-size: 0.875rem;">
            Error absoluto medio (Mean Absolute Error)
        </p>
    </div>
</div>

<!-- MSE Detallado -->
<div class="card">
    <h2 class="card-title">MSE - Error Cuadr√°tico Medio</h2>
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-label">MSE (Train)</div>
            <div class="metric-value" style="font-size: 1.5rem;">{{ metrics.train.mse|floatformat:2 }}</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">MSE (Validation)</div>
            <div class="metric-value" style="font-size: 1.5rem;">{{ metrics.validation.mse|floatformat:2 }}</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">MSE (Test)</div>
            <div class="metric-value" style="font-size: 1.5rem;">{{ metrics.test.mse|floatformat:2 }}</div>
        </div>
    </div>
</div>

<!-- Importancia de Caracter√≠sticas -->
{% if feature_importance %}
<div class="card">
    <h2 class="card-title">Top 10 - Caracter√≠sticas M√°s Importantes</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Ranking</th>
                    <th>Caracter√≠stica</th>
                    <th>Importancia</th>
                    <th>Barra Visual</th>
                </tr>
            </thead>
            <tbody>
                {% for item in feature_importance %}
                <tr>
                    <td><strong>{{ forloop.counter }}</strong></td>
                    <td>{{ item.feature }}</td>
                    <td>{{ item.importance|floatformat:6 }}</td>
                    <td>
                        <div style="background: var(--bg-tertiary); height: 20px; border-radius: 10px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, var(--accent), var(--success));
                                        width: {{ item.importance|floatformat:4|add:'0'|slice:'2:'|add:'%'|cut:' ' }};
                                        height: 100%;"></div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- Explicaci√≥n de M√©tricas -->
<div class="card">
    <h2 class="card-title">Explicaci√≥n de las M√©tricas</h2>
    <div style="display: grid; gap: 1rem;">
        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 6px;">
            <strong style="color: var(--accent);">R¬≤ Score (Coeficiente de Determinaci√≥n)</strong>
            <p style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.875rem;">
                Mide qu√© tan bien el modelo explica la variabilidad de los datos. Un valor de 1.0 indica predicciones perfectas, mientras que 0.0 indica que el modelo no es mejor que predecir la media.
            </p>
        </div>
        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 6px;">
            <strong style="color: var(--success);">RMSE (Root Mean Squared Error)</strong>
            <p style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.875rem;">
                Ra√≠z cuadrada del promedio de los errores al cuadrado. Da m√°s peso a errores grandes. Se expresa en las mismas unidades que la variable objetivo.
            </p>
        </div>
        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 6px;">
            <strong style="color: var(--warning);">MAE (Mean Absolute Error)</strong>
            <p style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.875rem;">
                Promedio de las diferencias absolutas entre predicciones y valores reales. M√°s f√°cil de interpretar que RMSE.
            </p>
        </div>
        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 6px;">
            <strong style="color: var(--error);">MSE (Mean Squared Error)</strong>
            <p style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.875rem;">
                Promedio de los errores al cuadrado. Penaliza m√°s los errores grandes. RMSE es su ra√≠z cuadrada.
            </p>
        </div>
    </div>
</div>

<div style="text-align: center; margin-top: 2rem;">
    <a href="/dashboard/" class="btn">Volver al Dashboard</a>
</div>
{% endblock %}

